/*
 * mdct.c
 */
#include <stdint.h>
#include <stdio.h>

typedef double REAL;
typedef int16_t INT16;

/* constants for MDCT and inverse MDCT */
#define G729EV_TDAC_L_WIN 320
#define G729EV_TDAC_L_WIN2 160
#define G729EV_TDAC_L_WIN4 80
#define G729EV_TDAC_NP 5
#define G729EV_TDAC_EXP_NPP 4
#define G729EV_TDAC_NB_REV 6
#define G729EV_TDAC_NPP (1 << G729EV_TDAC_EXP_NPP)

/***************************************************************/
/*                                                             */
/*                         MDCT TABLES                         */
/*                                                             */
/***************************************************************/

const REAL G729EV_TDAC_xcos[G729EV_TDAC_NP * G729EV_TDAC_NP] = {
    (REAL)1.000000000e+000,  (REAL)1.000000000e+000, (REAL)1.000000000e+000,  (REAL)1.000000000e+000,
    (REAL)1.000000000e+000,  (REAL)1.000000000e+000, (REAL)3.090169944e-001,  (REAL)-8.090169944e-001,
    (REAL)-8.090169944e-001, (REAL)3.090169944e-001, (REAL)1.000000000e+000,  (REAL)-8.090169944e-001,
    (REAL)3.090169944e-001,  (REAL)3.090169944e-001, (REAL)-8.090169944e-001, (REAL)1.000000000e+000,
    (REAL)-8.090169944e-001, (REAL)3.090169944e-001, (REAL)3.090169944e-001,  (REAL)-8.090169944e-001,
    (REAL)1.000000000e+000,  (REAL)3.090169944e-001, (REAL)-8.090169944e-001, (REAL)-8.090169944e-001,
    (REAL)3.090169944e-001};

const REAL G729EV_TDAC_xsin[G729EV_TDAC_NP * G729EV_TDAC_NP] = {
    (REAL)0.000000000e+000, (REAL)0.000000000e+000,  (REAL)0.000000000e+000,  (REAL)0.000000000e+000,
    (REAL)0.000000000e+000, (REAL)0.000000000e+000,  (REAL)-9.510565163e-001, (REAL)-5.877852523e-001,
    (REAL)5.877852523e-001, (REAL)9.510565163e-001,  (REAL)0.000000000e+000,  (REAL)-5.877852523e-001,
    (REAL)9.510565163e-001, (REAL)-9.510565163e-001, (REAL)5.877852523e-001,  (REAL)0.000000000e+000,
    (REAL)5.877852523e-001, (REAL)-9.510565163e-001, (REAL)9.510565163e-001,  (REAL)-5.877852523e-001,
    (REAL)0.000000000e+000, (REAL)9.510565163e-001,  (REAL)5.877852523e-001,  (REAL)-5.877852523e-001,
    (REAL)-9.510565163e-001};

const INT16 G729EV_TDAC_tab_map[G729EV_TDAC_NP * G729EV_TDAC_NPP] = {
    0,  65, 50, 35, 20, 5,  70, 55, 40, 25, 10, 75, 60, 45, 30, 15, 16, 1,  66, 51,
    36, 21, 6,  71, 56, 41, 26, 11, 76, 61, 46, 31, 32, 17, 2,  67, 52, 37, 22, 7,
    72, 57, 42, 27, 12, 77, 62, 47, 48, 33, 18, 3,  68, 53, 38, 23, 8,  73, 58, 43,
    28, 13, 78, 63, 64, 49, 34, 19, 4,  69, 54, 39, 24, 9,  74, 59, 44, 29, 14, 79};

const INT16 G729EV_TDAC_tab_map2[G729EV_TDAC_NP * G729EV_TDAC_NPP] = {
    0,  5,  10, 15, 20, 25, 30, 35, 40, 45, 50, 55, 60, 65, 70, 75, 16, 21, 26, 31,
    36, 41, 46, 51, 56, 61, 66, 71, 76, 1,  6,  11, 32, 37, 42, 47, 52, 57, 62, 67,
    72, 77, 2,  7,  12, 17, 22, 27, 48, 53, 58, 63, 68, 73, 78, 3,  8,  13, 18, 23,
    28, 33, 38, 43, 64, 69, 74, 79, 4,  9,  14, 19, 24, 29, 34, 39, 44, 49, 54, 59};

const INT16 G729EV_TDAC_tab_rev_ipp[G729EV_TDAC_NB_REV] = {1, 2, 3, 5, 7, 11};

const INT16 G729EV_TDAC_tab_rev_i[G729EV_TDAC_NB_REV] = {8, 4, 12, 10, 14, 13};

const REAL G729EV_TDAC_rw1[G729EV_TDAC_L_WIN4] = {
    (REAL)1.000000000e+000,  (REAL)9.969173337e-001,  (REAL)9.876883406e-001,  (REAL)9.723699204e-001,
    (REAL)9.510565163e-001,  (REAL)9.238795325e-001,  (REAL)8.910065242e-001,  (REAL)8.526401644e-001,
    (REAL)8.090169944e-001,  (REAL)7.604059656e-001,  (REAL)7.071067812e-001,  (REAL)6.494480483e-001,
    (REAL)5.877852523e-001,  (REAL)5.224985647e-001,  (REAL)4.539904997e-001,  (REAL)3.826834324e-001,
    (REAL)3.090169944e-001,  (REAL)2.334453639e-001,  (REAL)1.564344650e-001,  (REAL)7.845909573e-002,
    (REAL)6.123031769e-017,  (REAL)-7.845909573e-002, (REAL)-1.564344650e-001, (REAL)-2.334453639e-001,
    (REAL)-3.090169944e-001, (REAL)-3.826834324e-001, (REAL)-4.539904997e-001, (REAL)-5.224985647e-001,
    (REAL)-5.877852523e-001, (REAL)-6.494480483e-001, (REAL)-7.071067812e-001, (REAL)-7.604059656e-001,
    (REAL)-8.090169944e-001, (REAL)-8.526401644e-001, (REAL)-8.910065242e-001, (REAL)-9.238795325e-001,
    (REAL)-9.510565163e-001, (REAL)-9.723699204e-001, (REAL)-9.876883406e-001, (REAL)-9.969173337e-001,
    (REAL)-1.000000000e+000, (REAL)-9.969173337e-001, (REAL)-9.876883406e-001, (REAL)-9.723699204e-001,
    (REAL)-9.510565163e-001, (REAL)-9.238795325e-001, (REAL)-8.910065242e-001, (REAL)-8.526401644e-001,
    (REAL)-8.090169944e-001, (REAL)-7.604059656e-001, (REAL)-7.071067812e-001, (REAL)-6.494480483e-001,
    (REAL)-5.877852523e-001, (REAL)-5.224985647e-001, (REAL)-4.539904997e-001, (REAL)-3.826834324e-001,
    (REAL)-3.090169944e-001, (REAL)-2.334453639e-001, (REAL)-1.564344650e-001, (REAL)-7.845909573e-002,
    (REAL)-1.836909531e-016, (REAL)7.845909573e-002,  (REAL)1.564344650e-001,  (REAL)2.334453639e-001,
    (REAL)3.090169944e-001,  (REAL)3.826834324e-001,  (REAL)4.539904997e-001,  (REAL)5.224985647e-001,
    (REAL)5.877852523e-001,  (REAL)6.494480483e-001,  (REAL)7.071067812e-001,  (REAL)7.604059656e-001,
    (REAL)8.090169944e-001,  (REAL)8.526401644e-001,  (REAL)8.910065242e-001,  (REAL)9.238795325e-001,
    (REAL)9.510565163e-001,  (REAL)9.723699204e-001,  (REAL)9.876883406e-001,  (REAL)9.969173337e-001};

const REAL G729EV_TDAC_rw2[G729EV_TDAC_L_WIN4] = {
    (REAL)0.000000000e+000,  (REAL)7.845909573e-002,  (REAL)1.564344650e-001,  (REAL)2.334453639e-001,
    (REAL)3.090169944e-001,  (REAL)3.826834324e-001,  (REAL)4.539904997e-001,  (REAL)5.224985647e-001,
    (REAL)5.877852523e-001,  (REAL)6.494480483e-001,  (REAL)7.071067812e-001,  (REAL)7.604059656e-001,
    (REAL)8.090169944e-001,  (REAL)8.526401644e-001,  (REAL)8.910065242e-001,  (REAL)9.238795325e-001,
    (REAL)9.510565163e-001,  (REAL)9.723699204e-001,  (REAL)9.876883406e-001,  (REAL)9.969173337e-001,
    (REAL)1.000000000e+000,  (REAL)9.969173337e-001,  (REAL)9.876883406e-001,  (REAL)9.723699204e-001,
    (REAL)9.510565163e-001,  (REAL)9.238795325e-001,  (REAL)8.910065242e-001,  (REAL)8.526401644e-001,
    (REAL)8.090169944e-001,  (REAL)7.604059656e-001,  (REAL)7.071067812e-001,  (REAL)6.494480483e-001,
    (REAL)5.877852523e-001,  (REAL)5.224985647e-001,  (REAL)4.539904997e-001,  (REAL)3.826834324e-001,
    (REAL)3.090169944e-001,  (REAL)2.334453639e-001,  (REAL)1.564344650e-001,  (REAL)7.845909573e-002,
    (REAL)1.224606354e-016,  (REAL)-7.845909573e-002, (REAL)-1.564344650e-001, (REAL)-2.334453639e-001,
    (REAL)-3.090169944e-001, (REAL)-3.826834324e-001, (REAL)-4.539904997e-001, (REAL)-5.224985647e-001,
    (REAL)-5.877852523e-001, (REAL)-6.494480483e-001, (REAL)-7.071067812e-001, (REAL)-7.604059656e-001,
    (REAL)-8.090169944e-001, (REAL)-8.526401644e-001, (REAL)-8.910065242e-001, (REAL)-9.238795325e-001,
    (REAL)-9.510565163e-001, (REAL)-9.723699204e-001, (REAL)-9.876883406e-001, (REAL)-9.969173337e-001,
    (REAL)-1.000000000e+000, (REAL)-9.969173337e-001, (REAL)-9.876883406e-001, (REAL)-9.723699204e-001,
    (REAL)-9.510565163e-001, (REAL)-9.238795325e-001, (REAL)-8.910065242e-001, (REAL)-8.526401644e-001,
    (REAL)-8.090169944e-001, (REAL)-7.604059656e-001, (REAL)-7.071067812e-001, (REAL)-6.494480483e-001,
    (REAL)-5.877852523e-001, (REAL)-5.224985647e-001, (REAL)-4.539904997e-001, (REAL)-3.826834324e-001,
    (REAL)-3.090169944e-001, (REAL)-2.334453639e-001, (REAL)-1.564344650e-001, (REAL)-7.845909573e-002};

const REAL G729EV_TDAC_wcos[G729EV_TDAC_L_WIN4] = {
    (REAL)1.000000000e+000, (REAL)9.998072405e-001, (REAL)9.992290362e-001, (REAL)9.982656102e-001,
    (REAL)9.969173337e-001, (REAL)9.951847267e-001, (REAL)9.930684570e-001, (REAL)9.905693404e-001,
    (REAL)9.876883406e-001, (REAL)9.844265681e-001, (REAL)9.807852804e-001, (REAL)9.767658813e-001,
    (REAL)9.723699204e-001, (REAL)9.675990924e-001, (REAL)9.624552365e-001, (REAL)9.569403357e-001,
    (REAL)9.510565163e-001, (REAL)9.448060465e-001, (REAL)9.381913359e-001, (REAL)9.312149348e-001,
    (REAL)9.238795325e-001, (REAL)9.161879571e-001, (REAL)9.081431738e-001, (REAL)8.997482841e-001,
    (REAL)8.910065242e-001, (REAL)8.819212643e-001, (REAL)8.724960071e-001, (REAL)8.627343860e-001,
    (REAL)8.526401644e-001, (REAL)8.422172337e-001, (REAL)8.314696123e-001, (REAL)8.204014435e-001,
    (REAL)8.090169944e-001, (REAL)7.973206538e-001, (REAL)7.853169309e-001, (REAL)7.730104534e-001,
    (REAL)7.604059656e-001, (REAL)7.475083269e-001, (REAL)7.343225094e-001, (REAL)7.208535967e-001,
    (REAL)7.071067812e-001, (REAL)6.930873625e-001, (REAL)6.788007455e-001, (REAL)6.642524379e-001,
    (REAL)6.494480483e-001, (REAL)6.343932842e-001, (REAL)6.190939493e-001, (REAL)6.035559420e-001,
    (REAL)5.877852523e-001, (REAL)5.717879602e-001, (REAL)5.555702330e-001, (REAL)5.391383229e-001,
    (REAL)5.224985647e-001, (REAL)5.056573734e-001, (REAL)4.886212415e-001, (REAL)4.713967368e-001,
    (REAL)4.539904997e-001, (REAL)4.364092407e-001, (REAL)4.186597375e-001, (REAL)4.007488331e-001,
    (REAL)3.826834324e-001, (REAL)3.644704999e-001, (REAL)3.461170571e-001, (REAL)3.276301796e-001,
    (REAL)3.090169944e-001, (REAL)2.902846773e-001, (REAL)2.714404499e-001, (REAL)2.524915770e-001,
    (REAL)2.334453639e-001, (REAL)2.143091531e-001, (REAL)1.950903220e-001, (REAL)1.757962799e-001,
    (REAL)1.564344650e-001, (REAL)1.370123417e-001, (REAL)1.175373975e-001, (REAL)9.801714033e-002,
    (REAL)7.845909573e-002, (REAL)5.887080365e-002, (REAL)3.925981576e-002, (REAL)1.963369246e-002};

const REAL G729EV_TDAC_wsin[G729EV_TDAC_L_WIN4] = {
    (REAL)0.000000000e+000, (REAL)1.963369246e-002, (REAL)3.925981576e-002, (REAL)5.887080365e-002,
    (REAL)7.845909573e-002, (REAL)9.801714033e-002, (REAL)1.175373975e-001, (REAL)1.370123417e-001,
    (REAL)1.564344650e-001, (REAL)1.757962799e-001, (REAL)1.950903220e-001, (REAL)2.143091531e-001,
    (REAL)2.334453639e-001, (REAL)2.524915770e-001, (REAL)2.714404499e-001, (REAL)2.902846773e-001,
    (REAL)3.090169944e-001, (REAL)3.276301796e-001, (REAL)3.461170571e-001, (REAL)3.644704999e-001,
    (REAL)3.826834324e-001, (REAL)4.007488331e-001, (REAL)4.186597375e-001, (REAL)4.364092407e-001,
    (REAL)4.539904997e-001, (REAL)4.713967368e-001, (REAL)4.886212415e-001, (REAL)5.056573734e-001,
    (REAL)5.224985647e-001, (REAL)5.391383229e-001, (REAL)5.555702330e-001, (REAL)5.717879602e-001,
    (REAL)5.877852523e-001, (REAL)6.035559420e-001, (REAL)6.190939493e-001, (REAL)6.343932842e-001,
    (REAL)6.494480483e-001, (REAL)6.642524379e-001, (REAL)6.788007455e-001, (REAL)6.930873625e-001,
    (REAL)7.071067812e-001, (REAL)7.208535967e-001, (REAL)7.343225094e-001, (REAL)7.475083269e-001,
    (REAL)7.604059656e-001, (REAL)7.730104534e-001, (REAL)7.853169309e-001, (REAL)7.973206538e-001,
    (REAL)8.090169944e-001, (REAL)8.204014435e-001, (REAL)8.314696123e-001, (REAL)8.422172337e-001,
    (REAL)8.526401644e-001, (REAL)8.627343860e-001, (REAL)8.724960071e-001, (REAL)8.819212643e-001,
    (REAL)8.910065242e-001, (REAL)8.997482841e-001, (REAL)9.081431738e-001, (REAL)9.161879571e-001,
    (REAL)9.238795325e-001, (REAL)9.312149348e-001, (REAL)9.381913359e-001, (REAL)9.448060465e-001,
    (REAL)9.510565163e-001, (REAL)9.569403357e-001, (REAL)9.624552365e-001, (REAL)9.675990924e-001,
    (REAL)9.723699204e-001, (REAL)9.767658813e-001, (REAL)9.807852804e-001, (REAL)9.844265681e-001,
    (REAL)9.876883406e-001, (REAL)9.905693404e-001, (REAL)9.930684570e-001, (REAL)9.951847267e-001,
    (REAL)9.969173337e-001, (REAL)9.982656102e-001, (REAL)9.992290362e-001, (REAL)9.998072405e-001};

const REAL G729EV_TDAC_wetr[G729EV_TDAC_L_WIN4] = {
    (REAL)-2.220528908e-003, (REAL)2.263272134e-003, (REAL)-2.305142826e-003, (REAL)2.346124842e-003,
    (REAL)-2.386202382e-003, (REAL)2.425359995e-003, (REAL)-2.463582586e-003, (REAL)2.500855419e-003,
    (REAL)-2.537164125e-003, (REAL)2.572494706e-003, (REAL)-2.606833540e-003, (REAL)2.640167391e-003,
    (REAL)-2.672483408e-003, (REAL)2.703769130e-003, (REAL)-2.734012499e-003, (REAL)2.763201854e-003,
    (REAL)-2.791325941e-003, (REAL)2.818373920e-003, (REAL)-2.844335361e-003, (REAL)2.869200257e-003,
    (REAL)-2.892959022e-003, (REAL)2.915602496e-003, (REAL)-2.937121950e-003, (REAL)2.957509088e-003,
    (REAL)-2.976756049e-003, (REAL)2.994855414e-003, (REAL)-3.011800206e-003, (REAL)3.027583891e-003,
    (REAL)-3.042200385e-003, (REAL)3.055644052e-003, (REAL)-3.067909711e-003, (REAL)3.078992632e-003,
    (REAL)-3.088888543e-003, (REAL)3.097593629e-003, (REAL)-3.105104533e-003, (REAL)3.111418361e-003,
    (REAL)-3.116532677e-003, (REAL)3.120445511e-003, (REAL)-3.123155353e-003, (REAL)3.124661160e-003,
    (REAL)-3.124962351e-003, (REAL)3.124058808e-003, (REAL)-3.121950882e-003, (REAL)3.118639384e-003,
    (REAL)-3.114125592e-003, (REAL)3.108411245e-003, (REAL)-3.101498546e-003, (REAL)3.093390160e-003,
    (REAL)-3.084089213e-003, (REAL)3.073599292e-003, (REAL)-3.061924439e-003, (REAL)3.049069156e-003,
    (REAL)-3.035038399e-003, (REAL)3.019837577e-003, (REAL)-3.003472550e-003, (REAL)2.985949628e-003,
    (REAL)-2.967275564e-003, (REAL)2.947457560e-003, (REAL)-2.926503255e-003, (REAL)2.904420726e-003,
    (REAL)-2.881218489e-003, (REAL)2.856905487e-003, (REAL)-2.831491093e-003, (REAL)2.804985106e-003,
    (REAL)-2.777397743e-003, (REAL)2.748739641e-003, (REAL)-2.719021847e-003, (REAL)2.688255819e-003,
    (REAL)-2.656453417e-003, (REAL)2.623626901e-003, (REAL)-2.589788928e-003, (REAL)2.554952541e-003,
    (REAL)-2.519131172e-003, (REAL)2.482338629e-003, (REAL)-2.444589098e-003, (REAL)2.405897131e-003,
    (REAL)-2.366277645e-003, (REAL)2.325745914e-003, (REAL)-2.284317564e-003, (REAL)2.242008566e-003};

const REAL G729EV_TDAC_weti[G729EV_TDAC_L_WIN4] = {
    (REAL)2.198835230e-003,  (REAL)-2.154814202e-003, (REAL)2.109962452e-003,  (REAL)-2.064297272e-003,
    (REAL)2.017836265e-003,  (REAL)-1.970597344e-003, (REAL)1.922598721e-003,  (REAL)-1.873858899e-003,
    (REAL)1.824396668e-003,  (REAL)-1.774231098e-003, (REAL)1.723381528e-003,  (REAL)-1.671867562e-003,
    (REAL)1.619709059e-003,  (REAL)-1.566926127e-003, (REAL)1.513539116e-003,  (REAL)-1.459568606e-003,
    (REAL)1.405035405e-003,  (REAL)-1.349960536e-003, (REAL)1.294365232e-003,  (REAL)-1.238270925e-003,
    (REAL)1.181699241e-003,  (REAL)-1.124671989e-003, (REAL)1.067211155e-003,  (REAL)-1.009338891e-003,
    (REAL)9.510775074e-004,  (REAL)-8.924494654e-004, (REAL)8.334773671e-004,  (REAL)-7.741839474e-004,
    (REAL)7.145920651e-004,  (REAL)-6.547246939e-004, (REAL)5.946049139e-004,  (REAL)-5.342559024e-004,
    (REAL)4.737009250e-004,  (REAL)-4.129633270e-004, (REAL)3.520665237e-004,  (REAL)-2.910339920e-004,
    (REAL)2.298892612e-004,  (REAL)-1.686559038e-004, (REAL)1.073575262e-004,  (REAL)-4.601776035e-005,
    (REAL)-1.533974627e-005, (REAL)7.669133913e-005,  (REAL)-1.380133660e-004, (REAL)1.992821861e-004,
    (REAL)-2.604741792e-004, (REAL)3.215657544e-004,  (REAL)-3.825333600e-004, (REAL)4.433534917e-004,
    (REAL)-5.040027021e-004, (REAL)5.644576099e-004,  (REAL)-6.246949086e-004, (REAL)6.846913755e-004,
    (REAL)-7.444238808e-004, (REAL)8.038693966e-004,  (REAL)-8.630050054e-004, (REAL)9.218079093e-004,
    (REAL)-9.802554387e-004, (REAL)1.038325061e-003,  (REAL)-1.095994389e-003, (REAL)1.153241191e-003,
    (REAL)-1.210043396e-003, (REAL)1.266379106e-003,  (REAL)-1.322226603e-003, (REAL)1.377564357e-003,
    (REAL)-1.432371033e-003, (REAL)1.486625503e-003,  (REAL)-1.540306851e-003, (REAL)1.593394381e-003,
    (REAL)-1.645867627e-003, (REAL)1.697706359e-003,  (REAL)-1.748890594e-003, (REAL)1.799400598e-003,
    (REAL)-1.849216899e-003, (REAL)1.898320292e-003,  (REAL)-1.946691845e-003, (REAL)1.994312913e-003,
    (REAL)-2.041165134e-003, (REAL)2.087230448e-003,  (REAL)-2.132491094e-003, (REAL)2.176929625e-003};

const REAL G729EV_TDAC_wetrm1[G729EV_TDAC_L_WIN4] = {
    (REAL)-1.421138501e+000, (REAL)1.448494166e+000, (REAL)-1.475291409e+000, (REAL)1.501519899e+000,
    (REAL)-1.527169524e+000, (REAL)1.552230397e+000, (REAL)-1.576692855e+000, (REAL)1.600547468e+000,
    (REAL)-1.623785040e+000, (REAL)1.646396612e+000, (REAL)-1.668373466e+000, (REAL)1.689707130e+000,
    (REAL)-1.710389381e+000, (REAL)1.730412244e+000, (REAL)-1.749767999e+000, (REAL)1.768449186e+000,
    (REAL)-1.786448602e+000, (REAL)1.803759309e+000, (REAL)-1.820374631e+000, (REAL)1.836288165e+000,
    (REAL)-1.851493774e+000, (REAL)1.865985598e+000, (REAL)-1.879758048e+000, (REAL)1.892805816e+000,
    (REAL)-1.905123871e+000, (REAL)1.916707465e+000, (REAL)-1.927552132e+000, (REAL)1.937653690e+000,
    (REAL)-1.947008246e+000, (REAL)1.955612194e+000, (REAL)-1.963462215e+000, (REAL)1.970555285e+000,
    (REAL)-1.976888668e+000, (REAL)1.982459923e+000, (REAL)-1.987266901e+000, (REAL)1.991307751e+000,
    (REAL)-1.994580913e+000, (REAL)1.997085127e+000, (REAL)-1.998819426e+000, (REAL)1.999783142e+000,
    (REAL)-1.999975904e+000, (REAL)1.999397637e+000, (REAL)-1.998048565e+000, (REAL)1.995929206e+000,
    (REAL)-1.993040379e+000, (REAL)1.989383197e+000, (REAL)-1.984959069e+000, (REAL)1.979769702e+000,
    (REAL)-1.973817097e+000, (REAL)1.967103547e+000, (REAL)-1.959631641e+000, (REAL)1.951404260e+000,
    (REAL)-1.942424576e+000, (REAL)1.932696049e+000, (REAL)-1.922222432e+000, (REAL)1.911007762e+000,
    (REAL)-1.899056361e+000, (REAL)1.886372838e+000, (REAL)-1.872962083e+000, (REAL)1.858829265e+000,
    (REAL)-1.843979833e+000, (REAL)1.828419511e+000, (REAL)-1.812154299e+000, (REAL)1.795190468e+000,
    (REAL)-1.777534556e+000, (REAL)1.759193370e+000, (REAL)-1.740173982e+000, (REAL)1.720483724e+000,
    (REAL)-1.700130187e+000, (REAL)1.679121217e+000, (REAL)-1.657464914e+000, (REAL)1.635169626e+000,
    (REAL)-1.612243950e+000, (REAL)1.588696723e+000, (REAL)-1.564537023e+000, (REAL)1.539774164e+000,
    (REAL)-1.514417693e+000, (REAL)1.488477385e+000, (REAL)-1.461963241e+000, (REAL)1.434885482e+000};

const REAL G729EV_TDAC_wetim1[G729EV_TDAC_L_WIN4] = {
    (REAL)-1.407254547e+000, (REAL)1.379081089e+000,  (REAL)-1.350375969e+000, (REAL)1.321150254e+000,
    (REAL)-1.291415210e+000, (REAL)1.261182300e+000,  (REAL)-1.230463181e+000, (REAL)1.199269695e+000,
    (REAL)-1.167613868e+000, (REAL)1.135507903e+000,  (REAL)-1.102964178e+000, (REAL)1.069995240e+000,
    (REAL)-1.036613798e+000, (REAL)1.002832722e+000,  (REAL)-9.686650342e-001, (REAL)9.341239080e-001,
    (REAL)-8.992226593e-001, (REAL)8.639747431e-001,  (REAL)-8.283937482e-001, (REAL)7.924933918e-001,
    (REAL)-7.562875140e-001, (REAL)7.197900731e-001,  (REAL)-6.830151393e-001, (REAL)6.459768902e-001,
    (REAL)-6.086896048e-001, (REAL)5.711676579e-001,  (REAL)-5.334255149e-001, (REAL)4.954777264e-001,
    (REAL)-4.573389217e-001, (REAL)4.190238041e-001,  (REAL)-3.805471449e-001, (REAL)3.419237775e-001,
    (REAL)-3.031685920e-001, (REAL)2.642965293e-001,  (REAL)-2.253225751e-001, (REAL)1.862617549e-001,
    (REAL)-1.471291272e-001, (REAL)1.079397784e-001,  (REAL)-6.870881680e-002, (REAL)2.945136662e-002,
    (REAL)9.817437616e-003,  (REAL)-4.908245705e-002, (REAL)8.832855425e-002,  (REAL)-1.275405991e-001,
    (REAL)1.667034747e-001,  (REAL)-2.058020828e-001, (REAL)2.448213504e-001,  (REAL)-2.837462347e-001,
    (REAL)3.225617294e-001,  (REAL)-3.612528704e-001, (REAL)3.998047415e-001,  (REAL)-4.382024803e-001,
    (REAL)4.764312837e-001,  (REAL)-5.144764138e-001, (REAL)5.523232034e-001,  (REAL)-5.899570620e-001,
    (REAL)6.273634808e-001,  (REAL)-6.645280391e-001, (REAL)7.014364091e-001,  (REAL)-7.380743621e-001,
    (REAL)7.744277734e-001,  (REAL)-8.104826280e-001, (REAL)8.462250261e-001,  (REAL)-8.816411884e-001,
    (REAL)9.167174612e-001,  (REAL)-9.514403220e-001, (REAL)9.857963845e-001,  (REAL)-1.019772404e+000,
    (REAL)1.053355281e+000,  (REAL)-1.086532070e+000, (REAL)1.119289980e+000,  (REAL)-1.151616383e+000,
    (REAL)1.183498815e+000,  (REAL)-1.214924987e+000, (REAL)1.245882781e+000,  (REAL)-1.276360264e+000,
    (REAL)1.306345686e+000,  (REAL)-1.335827487e+000, (REAL)1.364794300e+000,  (REAL)-1.393234960e+000};

const REAL G729EV_TDAC_h[G729EV_TDAC_L_WIN] = {
    (REAL)6.941976712e-003, (REAL)2.082526105e-002, (REAL)3.470653821e-002, (REAL)4.858447029e-002,
    (REAL)6.245771969e-002, (REAL)7.632494928e-002, (REAL)9.018482252e-002, (REAL)1.040360036e-001,
    (REAL)1.178771574e-001, (REAL)1.317069500e-001, (REAL)1.455240484e-001, (REAL)1.593271208e-001,
    (REAL)1.731148370e-001, (REAL)1.868858681e-001, (REAL)2.006388867e-001, (REAL)2.143725673e-001,
    (REAL)2.280855862e-001, (REAL)2.417766217e-001, (REAL)2.554443544e-001, (REAL)2.690874667e-001,
    (REAL)2.827046439e-001, (REAL)2.962945734e-001, (REAL)3.098559454e-001, (REAL)3.233874528e-001,
    (REAL)3.368877915e-001, (REAL)3.503556602e-001, (REAL)3.637897610e-001, (REAL)3.771887989e-001,
    (REAL)3.905514826e-001, (REAL)4.038765241e-001, (REAL)4.171626391e-001, (REAL)4.304085472e-001,
    (REAL)4.436129715e-001, (REAL)4.567746396e-001, (REAL)4.698922827e-001, (REAL)4.829646367e-001,
    (REAL)4.959904415e-001, (REAL)5.089684417e-001, (REAL)5.218973865e-001, (REAL)5.347760297e-001,
    (REAL)5.476031301e-001, (REAL)5.603774514e-001, (REAL)5.730977623e-001, (REAL)5.857628369e-001,
    (REAL)5.983714544e-001, (REAL)6.109223996e-001, (REAL)6.234144629e-001, (REAL)6.358464402e-001,
    (REAL)6.482171333e-001, (REAL)6.605253498e-001, (REAL)6.727699036e-001, (REAL)6.849496144e-001,
    (REAL)6.970633083e-001, (REAL)7.091098178e-001, (REAL)7.210879819e-001, (REAL)7.329966459e-001,
    (REAL)7.448346623e-001, (REAL)7.566008899e-001, (REAL)7.682941947e-001, (REAL)7.799134498e-001,
    (REAL)7.914575352e-001, (REAL)8.029253382e-001, (REAL)8.143157536e-001, (REAL)8.256276836e-001,
    (REAL)8.368600379e-001, (REAL)8.480117338e-001, (REAL)8.590816967e-001, (REAL)8.700688594e-001,
    (REAL)8.809721631e-001, (REAL)8.917905569e-001, (REAL)9.025229980e-001, (REAL)9.131684521e-001,
    (REAL)9.237258931e-001, (REAL)9.341943035e-001, (REAL)9.445726743e-001, (REAL)9.548600052e-001,
    (REAL)9.650553047e-001, (REAL)9.751575902e-001, (REAL)9.851658879e-001, (REAL)9.950792334e-001,
    (REAL)1.004896671e+000, (REAL)1.014617255e+000, (REAL)1.024240047e+000, (REAL)1.033764121e+000,
    (REAL)1.043188559e+000, (REAL)1.052512453e+000, (REAL)1.061734903e+000, (REAL)1.070855020e+000,
    (REAL)1.079871927e+000, (REAL)1.088784753e+000, (REAL)1.097592640e+000, (REAL)1.106294738e+000,
    (REAL)1.114890210e+000, (REAL)1.123378226e+000, (REAL)1.131757969e+000, (REAL)1.140028630e+000,
    (REAL)1.148189413e+000, (REAL)1.156239531e+000, (REAL)1.164178209e+000, (REAL)1.172004680e+000,
    (REAL)1.179718191e+000, (REAL)1.187317999e+000, (REAL)1.194803370e+000, (REAL)1.202173584e+000,
    (REAL)1.209427930e+000, (REAL)1.216565708e+000, (REAL)1.223586232e+000, (REAL)1.230488823e+000,
    (REAL)1.237272818e+000, (REAL)1.243937561e+000, (REAL)1.250482412e+000, (REAL)1.256906738e+000,
    (REAL)1.263209921e+000, (REAL)1.269391353e+000, (REAL)1.275450439e+000, (REAL)1.281386594e+000,
    (REAL)1.287199246e+000, (REAL)1.292887835e+000, (REAL)1.298451814e+000, (REAL)1.303890644e+000,
    (REAL)1.309203803e+000, (REAL)1.314390778e+000, (REAL)1.319451070e+000, (REAL)1.324384190e+000,
    (REAL)1.329189663e+000, (REAL)1.333867026e+000, (REAL)1.338415828e+000, (REAL)1.342835631e+000,
    (REAL)1.347126008e+000, (REAL)1.351286547e+000, (REAL)1.355316846e+000, (REAL)1.359216517e+000,
    (REAL)1.362985183e+000, (REAL)1.366622483e+000, (REAL)1.370128064e+000, (REAL)1.373501589e+000,
    (REAL)1.376742734e+000, (REAL)1.379851185e+000, (REAL)1.382826643e+000, (REAL)1.385668822e+000,
    (REAL)1.388377447e+000, (REAL)1.390952257e+000, (REAL)1.393393005e+000, (REAL)1.395699454e+000,
    (REAL)1.397871383e+000, (REAL)1.399908582e+000, (REAL)1.401810855e+000, (REAL)1.403578018e+000,
    (REAL)1.405209902e+000, (REAL)1.406706349e+000, (REAL)1.408067214e+000, (REAL)1.409292367e+000,
    (REAL)1.410381689e+000, (REAL)1.411335076e+000, (REAL)1.412152436e+000, (REAL)1.412833689e+000,
    (REAL)1.413378771e+000, (REAL)1.413787628e+000, (REAL)1.414060221e+000, (REAL)1.414196524e+000,
    (REAL)1.414196524e+000, (REAL)1.414060221e+000, (REAL)1.413787628e+000, (REAL)1.413378771e+000,
    (REAL)1.412833689e+000, (REAL)1.412152436e+000, (REAL)1.411335076e+000, (REAL)1.410381689e+000,
    (REAL)1.409292367e+000, (REAL)1.408067214e+000, (REAL)1.406706349e+000, (REAL)1.405209902e+000,
    (REAL)1.403578018e+000, (REAL)1.401810855e+000, (REAL)1.399908582e+000, (REAL)1.397871383e+000,
    (REAL)1.395699454e+000, (REAL)1.393393005e+000, (REAL)1.390952257e+000, (REAL)1.388377447e+000,
    (REAL)1.385668822e+000, (REAL)1.382826643e+000, (REAL)1.379851185e+000, (REAL)1.376742734e+000,
    (REAL)1.373501589e+000, (REAL)1.370128064e+000, (REAL)1.366622483e+000, (REAL)1.362985183e+000,
    (REAL)1.359216517e+000, (REAL)1.355316846e+000, (REAL)1.351286547e+000, (REAL)1.347126008e+000,
    (REAL)1.342835631e+000, (REAL)1.338415828e+000, (REAL)1.333867026e+000, (REAL)1.329189663e+000,
    (REAL)1.324384190e+000, (REAL)1.319451070e+000, (REAL)1.314390778e+000, (REAL)1.309203803e+000,
    (REAL)1.303890644e+000, (REAL)1.298451814e+000, (REAL)1.292887835e+000, (REAL)1.287199246e+000,
    (REAL)1.281386594e+000, (REAL)1.275450439e+000, (REAL)1.269391353e+000, (REAL)1.263209921e+000,
    (REAL)1.256906738e+000, (REAL)1.250482412e+000, (REAL)1.243937561e+000, (REAL)1.237272818e+000,
    (REAL)1.230488823e+000, (REAL)1.223586232e+000, (REAL)1.216565708e+000, (REAL)1.209427930e+000,
    (REAL)1.202173584e+000, (REAL)1.194803370e+000, (REAL)1.187317999e+000, (REAL)1.179718191e+000,
    (REAL)1.172004680e+000, (REAL)1.164178209e+000, (REAL)1.156239531e+000, (REAL)1.148189413e+000,
    (REAL)1.140028630e+000, (REAL)1.131757969e+000, (REAL)1.123378226e+000, (REAL)1.114890210e+000,
    (REAL)1.106294738e+000, (REAL)1.097592640e+000, (REAL)1.088784753e+000, (REAL)1.079871927e+000,
    (REAL)1.070855020e+000, (REAL)1.061734903e+000, (REAL)1.052512453e+000, (REAL)1.043188559e+000,
    (REAL)1.033764121e+000, (REAL)1.024240047e+000, (REAL)1.014617255e+000, (REAL)1.004896671e+000,
    (REAL)9.950792334e-001, (REAL)9.851658879e-001, (REAL)9.751575902e-001, (REAL)9.650553047e-001,
    (REAL)9.548600052e-001, (REAL)9.445726743e-001, (REAL)9.341943035e-001, (REAL)9.237258931e-001,
    (REAL)9.131684521e-001, (REAL)9.025229980e-001, (REAL)8.917905569e-001, (REAL)8.809721631e-001,
    (REAL)8.700688594e-001, (REAL)8.590816967e-001, (REAL)8.480117338e-001, (REAL)8.368600379e-001,
    (REAL)8.256276836e-001, (REAL)8.143157536e-001, (REAL)8.029253382e-001, (REAL)7.914575352e-001,
    (REAL)7.799134498e-001, (REAL)7.682941947e-001, (REAL)7.566008899e-001, (REAL)7.448346623e-001,
    (REAL)7.329966459e-001, (REAL)7.210879819e-001, (REAL)7.091098178e-001, (REAL)6.970633083e-001,
    (REAL)6.849496144e-001, (REAL)6.727699036e-001, (REAL)6.605253498e-001, (REAL)6.482171333e-001,
    (REAL)6.358464402e-001, (REAL)6.234144629e-001, (REAL)6.109223996e-001, (REAL)5.983714544e-001,
    (REAL)5.857628369e-001, (REAL)5.730977623e-001, (REAL)5.603774514e-001, (REAL)5.476031301e-001,
    (REAL)5.347760297e-001, (REAL)5.218973865e-001, (REAL)5.089684417e-001, (REAL)4.959904415e-001,
    (REAL)4.829646367e-001, (REAL)4.698922827e-001, (REAL)4.567746396e-001, (REAL)4.436129715e-001,
    (REAL)4.304085472e-001, (REAL)4.171626391e-001, (REAL)4.038765241e-001, (REAL)3.905514826e-001,
    (REAL)3.771887989e-001, (REAL)3.637897610e-001, (REAL)3.503556602e-001, (REAL)3.368877915e-001,
    (REAL)3.233874528e-001, (REAL)3.098559454e-001, (REAL)2.962945734e-001, (REAL)2.827046439e-001,
    (REAL)2.690874667e-001, (REAL)2.554443544e-001, (REAL)2.417766217e-001, (REAL)2.280855862e-001,
    (REAL)2.143725673e-001, (REAL)2.006388867e-001, (REAL)1.868858681e-001, (REAL)1.731148370e-001,
    (REAL)1.593271208e-001, (REAL)1.455240484e-001, (REAL)1.317069500e-001, (REAL)1.178771574e-001,
    (REAL)1.040360036e-001, (REAL)9.018482252e-002, (REAL)7.632494928e-002, (REAL)6.245771969e-002,
    (REAL)4.858447029e-002, (REAL)3.470653821e-002, (REAL)2.082526105e-002, (REAL)6.941976712e-003};

/*--------------------------------------------------------------------------*
 *  Function  G729EV_TDAC_tfr()                                             *
 *  ~~~~~~~~~~~~~~~~~~~~~~~~~~~                                             *
 *  The good thomas fast fourier transform                                  *
 *--------------------------------------------------------------------------*/

void G729EV_TDAC_tfr(REAL *x1, /* (i/o) pointer on the real part of data       */
                     REAL *x2, /* (i/o) pointer on the imaginary part of data  */
                     int sign) /* (i) flag to select FFT (1) or IFFT (-1)      */
{

    REAL tab_x1[G729EV_TDAC_NP * G729EV_TDAC_NPP];
    REAL tab_x2[G729EV_TDAC_NP * G729EV_TDAC_NPP];
    REAL rx1[G729EV_TDAC_NP];
    REAL rx2[G729EV_TDAC_NP];

    REAL *ptr_x1;         /* Pointer on tab_x1 */
    REAL *ptr_x2;         /* Pointer on tab_x2 */
    REAL *ptr0_x1;        /* Pointer on tab_x1 for DFT step */
    REAL *ptr0_x2;        /* Pointer on tab_x2 for DFT step */
    const REAL *ptr_cos;  /* Pointer on cos table */
    const REAL *ptr_sin;  /* Pointer on sin table */
    const INT16 *ptr_map; /* Pointer on mapping indice (input and output) */

    int ip, ipp, i, j;
    REAL x1_tmp;
    REAL x2_tmp;
    int exp_n2;
    int n1;
    int n2; /* size of sub array */
    int n3;
    int p; /* size of the butterfly */
    int inkw;
    REAL rix;
    REAL cix;
    REAL rjx;
    REAL cjx;

    /********************************************************************************
     * Mapping for the input indices (Good Thomas FTT)                              *
     ********************************************************************************/
    ptr_x1 = tab_x1;
    ptr_x2 = tab_x2;
    ptr_map = G729EV_TDAC_tab_map;
    for (ip = 0; ip < G729EV_TDAC_NP; ip++) {
        for (ipp = 0; ipp < G729EV_TDAC_NPP; ipp++) {
            i = (int)*ptr_map++;
            *ptr_x1++ = x1[i];
            *ptr_x2++ = x2[i];
        }
    }

    /***************************************************************************/
    ptr_x1 = tab_x1;
    ptr_x2 = tab_x2;
    for (ip = 0; ip < G729EV_TDAC_NP; ip++) {
        for (j = 0; j < G729EV_TDAC_NB_REV; j++) {
            i = G729EV_TDAC_tab_rev_i[j];
            ipp = G729EV_TDAC_tab_rev_ipp[j];
            x1_tmp = ptr_x1[ipp]; /* swap value ptr_x1[i] and ptr_x1[ipp] */
            x2_tmp = ptr_x2[ipp]; /* swap value ptr_x2[i] and ptr_x2[ipp] */
            ptr_x1[ipp] = ptr_x1[i];
            ptr_x2[ipp] = ptr_x2[i];
            ptr_x1[i] = x1_tmp;
            ptr_x2[i] = x2_tmp;
        }
        ptr_x1 += G729EV_TDAC_NPP;
        ptr_x2 += G729EV_TDAC_NPP;
    }

    /*******************************************************************************
     * n1 size of butterfly                                                        *
     *******************************************************************************/
    ptr_x1 = tab_x1;
    ptr_x2 = tab_x2;
    for (ip = 0; ip < G729EV_TDAC_NP; ip++) {
        for (exp_n2 = 0; exp_n2 <= G729EV_TDAC_EXP_NPP; exp_n2++) {
            /*  n2 : size of sub arrays */
            n2 = 1 << exp_n2;
            n1 = n2 >> 1;
            n3 = G729EV_TDAC_EXP_NPP - exp_n2;
            /* p equal the size of the butterfly */
            for (p = 0; p < n1; p++) {
                /*  get twiddle factor in arrays rw1 and rw2 */
                inkw = (p * G729EV_TDAC_NP) << n3;
                x1_tmp = G729EV_TDAC_rw1[inkw];
                x2_tmp = -(REAL)sign * G729EV_TDAC_rw2[inkw];

                for (i = p; i < G729EV_TDAC_NPP; i += n2) {
                    /*  selecet item p in array p */
                    j = i + n1;
                    /*   butterfly on x[i] and x[j] */
                    rix = ptr_x1[i];
                    cix = ptr_x2[i];
                    /*  twiddle factor */
                    rjx = (x1_tmp * ptr_x1[j]) - (x2_tmp * ptr_x2[j]);
                    cjx = (x2_tmp * ptr_x1[j]) + (x1_tmp * ptr_x2[j]);
                    ptr_x1[i] = rix + rjx;
                    ptr_x2[i] = cix + cjx;
                    ptr_x1[j] = rix - rjx;
                    ptr_x2[j] = cix - cjx;
                }
            }
        } /* end while */
        ptr_x1 += G729EV_TDAC_NPP;
        ptr_x2 += G729EV_TDAC_NPP;
    } /* end for ip */

    /**************************************************************************
     * G729EV_TDAC_NPP DFT (size 5)                                           *
     **************************************************************************/

    ptr0_x1 = tab_x1;
    ptr0_x2 = tab_x2;
    for (ipp = 0; ipp < G729EV_TDAC_NPP; ipp++) {
        ptr_x1 = ptr0_x1;
        ptr_x2 = ptr0_x2;
        for (ip = 0; ip < G729EV_TDAC_NP; ip++) {
            rx1[ip] = *ptr_x1;
            rx2[ip] = *ptr_x2;
            ptr_x1 += G729EV_TDAC_NPP;
            ptr_x2 += G729EV_TDAC_NPP;
        }

        ptr_x1 = ptr0_x1++;
        ptr_x2 = ptr0_x2++;
        ptr_cos = G729EV_TDAC_xcos;
        ptr_sin = G729EV_TDAC_xsin;
        if (sign > 0) /* FFT */
        {
            for (ip = 0; ip < G729EV_TDAC_NP; ip++) {
                x1_tmp = (REAL)0.0;
                x2_tmp = (REAL)0.0;
                for (i = 0; i < G729EV_TDAC_NP; i++) {
                    x1_tmp += rx1[i] * (*ptr_cos) - rx2[i] * (*ptr_sin);
                    x2_tmp += rx2[i] * (*ptr_cos++) + rx1[i] * (*ptr_sin++);
                }
                *ptr_x1 = x1_tmp;
                *ptr_x2 = x2_tmp;
                ptr_x1 += G729EV_TDAC_NPP;
                ptr_x2 += G729EV_TDAC_NPP;
            }  /*end for ip */
        } else /* IFFT */
        {
            for (ip = 0; ip < G729EV_TDAC_NP; ip++) {
                x1_tmp = (REAL)0.0;
                x2_tmp = (REAL)0.0;
                for (i = 0; i < G729EV_TDAC_NP; i++) {
                    x1_tmp += rx1[i] * (*ptr_cos) + rx2[i] * (*ptr_sin);
                    x2_tmp += rx2[i] * (*ptr_cos++) - rx1[i] * (*ptr_sin++);
                }
                *ptr_x1 = x1_tmp;
                *ptr_x2 = x2_tmp;
                ptr_x1 += G729EV_TDAC_NPP;
                ptr_x2 += G729EV_TDAC_NPP;
            } /*end for ip */
        }
    } /*end for ipp */

    /***************************************************************************
     * mapping for the output indices                                          *
     ***************************************************************************/
    ptr_x1 = tab_x1;
    ptr_x2 = tab_x2;
    ptr_map = G729EV_TDAC_tab_map2;
    for (ip = 0; ip < G729EV_TDAC_NP; ip++) {
        for (ipp = 0; ipp < G729EV_TDAC_NPP; ipp++) {
            i = (int)*ptr_map++;
            x1[i] = *ptr_x1++;
            x2[i] = *ptr_x2++;
        }
    }

    return;
}

/*--------------------------------------------------------------------------*
 *  Function  G729EV_TDAC_mdct()                                            *
 *  ~~~~~~~~~~~~~~~~~~~~~~~~~~                                              *
 *  Compute MDCT                                                            *
 * The MDCT is computed using the fast algorithm described in               *
 * - "A fast algorithm for the implementation of Filter Banks based on Time *
 * Domain Aliasing Cancellation", P. Duhamel et al., ICASSP91, pp 2209-2212 *
 * Petit, Conference ICASSP 1991, pp 2209 - 2212,                           *
 *                                                                          *
 *--------------------------------------------------------------------------*/
void G729EV_TDAC_mdct(REAL *mem,   /* (i)     old input samples */
                      REAL *input, /* (i)     input samples */
                      REAL *ykr    /* (o)     MDCT coefficients */
)
{
    REAL temp0, temp1;
    REAL xin[G729EV_TDAC_L_WIN];

    REAL ycr[G729EV_TDAC_L_WIN2], yci[G729EV_TDAC_L_WIN2];

    const REAL *ptr_h1, *ptr_h2; /* pointers on window */

    REAL *ptr_x1, *ptr_x2; /* pointers on input samples */
    REAL *ptr_ycr;         /* pointer on ycr */
    REAL *ptr_yci;         /* pointer on yci */

    int i, k;
    int sign; /* sign for FFT/IFFT */

    for (i = 0; i < G729EV_TDAC_L_WIN2; i++)
        xin[i] = mem[i];
    for (i = 0; i < G729EV_TDAC_L_WIN2; i++)
        xin[i + G729EV_TDAC_L_WIN2] = input[i];

    /*   MDCT computation */
    /*  1) computing Xc[n) (complex terms)   */
    ptr_h1 = G729EV_TDAC_h + G729EV_TDAC_L_WIN2; /* Middle of the window */
    ptr_x1 = xin + G729EV_TDAC_L_WIN2;

    ptr_h2 = G729EV_TDAC_h + G729EV_TDAC_L_WIN; /* End of the window */
    ptr_x2 = xin + G729EV_TDAC_L_WIN;
    k = 0;
    ptr_yci = yci;
    ptr_ycr = ycr;
    for (i = 0; i < G729EV_TDAC_L_WIN4; i++) {
        /*  real */
        ycr[i] = G729EV_TDAC_h[k] * xin[k] - ptr_h1[-k - 1] * ptr_x1[-k - 1];
        yci[i] = ptr_h2[-k - 1] * ptr_x2[-k - 1] + ptr_h1[k] * ptr_x1[k];
        k += 2;
    }

    /*  2) Product of Xc(n) by  W**i    */
    ptr_yci = yci;
    ptr_ycr = ycr;

    for (k = 0; k < G729EV_TDAC_L_WIN4; k++) {
        temp1 = *ptr_ycr;

        temp0 = temp1 * G729EV_TDAC_wcos[k];
        temp0 -= yci[k] * G729EV_TDAC_wsin[k];
        *ptr_ycr++ = temp0;

        temp0 = temp1 * G729EV_TDAC_wsin[k];
        temp0 += yci[k] * G729EV_TDAC_wcos[k];
        *ptr_yci++ = temp0;
    }

    /*  3) inverse  TFD */
    sign = -1;
    G729EV_TDAC_tfr(ycr, yci, sign);

    /*  4) final product and rearranging the results  */
    ptr_x1 = ykr;
    ptr_x2 = ykr + G729EV_TDAC_L_WIN2 - 1;
    for (k = 0; k < G729EV_TDAC_L_WIN4; k++) {
        temp1 = ycr[k];
        /* symmetry of the coeff k-1 and N-k */
        temp0 = yci[k] * G729EV_TDAC_weti[k];
        temp0 -= temp1 * G729EV_TDAC_wetr[k];
        *ptr_x2-- = temp0;
        ptr_x2--;

        temp0 = temp1 * G729EV_TDAC_weti[k];
        temp0 += yci[k] * G729EV_TDAC_wetr[k];
        *ptr_x1++ = temp0;
        ptr_x1++;
    }

    for (i = 0; i < G729EV_TDAC_L_WIN2; i++)
        mem[i] = input[i];

    return;
} /* END MDCT */

/*--------------------------------------------------------------------------*
 *  Function  G729EV_TDAC_inv_mdct()                                        *
 *  ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~                                          *
 *  Compute inverse MDCT and overlap-add                                    *
 * The underlying algorithm is described in                                 *
 * - "A fast algorithm for the implementation of Filter Banks based on Time *
 * Domain Aliasing Cancellation", P. Duhamel et al., ICASSP91, pp 2209-2212 *
 * Petit, Conference ICASSP 1991, pp 2209 - 2212,                           *
 *--------------------------------------------------------------------------*/
void G729EV_TDAC_inv_mdct(REAL *xr,   /* (o)     output samples */
                          REAL *ykq,  /* (i)     MDCT coefficients */
                          REAL *ycim1 /* (i)     previous MDCT memory */
)
{

    REAL temp, temp1;
    REAL ycr[G729EV_TDAC_L_WIN4], yci[G729EV_TDAC_L_WIN4];
    REAL sig_cur[G729EV_TDAC_L_WIN2], sig_next[G729EV_TDAC_L_WIN2];
    REAL *ptr_yci;
    REAL *ptr_ycr;
    REAL *ptr1;
    REAL *ptr2;
    REAL *ptr1_next;
    REAL *ptr2_next;
    const REAL *ptr_h; /* Pointer on window */

    int k;
    int sign; /* sign for FFT / IFFT */

    /*******************************************************************************/
    /* Inverse MDCT computation                                                    */
    /*******************************************************************************/

    /* 1 --> Input rotation = Product by wetrm1 */

    ptr1 = ykq;
    ptr2 = ykq + (G729EV_TDAC_L_WIN2 - 1);
    ptr_yci = yci;
    ptr_ycr = ycr;

    for (k = 0; k < G729EV_TDAC_L_WIN4; k++) {
        temp = -(*ptr2 * G729EV_TDAC_wetrm1[k]);
        temp -= *ptr1 * G729EV_TDAC_wetim1[k];
        *ptr_ycr++ = temp;

        temp = *ptr1++ * G729EV_TDAC_wetrm1[k];
        temp -= *ptr2-- * G729EV_TDAC_wetim1[k];
        *ptr_yci++ = temp;

        ptr1++;
        ptr2--;
    }

    /* 2 --> Forward FFT : size = 160 */

    sign = 1;
    G729EV_TDAC_tfr(ycr, yci, sign);

    /*  3) Output rotation = product by a complex exponent */
    ptr_yci = yci;
    ptr_ycr = ycr;

    for (k = 0; k < G729EV_TDAC_L_WIN4; k++) {
        temp1 = *ptr_ycr;
        temp = temp1 * G729EV_TDAC_wcos[k];
        temp += yci[k] * G729EV_TDAC_wsin[k];
        *ptr_ycr++ = temp;

        temp = yci[k] * G729EV_TDAC_wcos[k];
        temp -= temp1 * G729EV_TDAC_wsin[k];
        *ptr_yci++ = temp;
    }

    /* 4 --> Overlap and windowing (in one step) - equivalent to complex product */
    ptr1 = sig_cur;
    ptr2 = sig_cur + G729EV_TDAC_L_WIN2 - 1;
    ptr1_next = sig_next;
    ptr2_next = sig_next + G729EV_TDAC_L_WIN2 - 1;
    for (k = 0; k < G729EV_TDAC_L_WIN4; k++) {
        *ptr1++ = ycr[k];
        *ptr2-- = -ycr[k];
        *ptr1_next++ = yci[k];
        *ptr2_next-- = yci[k];
        ptr1++;
        ptr1_next++;
        ptr2--;
        ptr2_next--;
    }

    ptr_h = G729EV_TDAC_h + G729EV_TDAC_L_WIN2;

    for (k = 0; k < G729EV_TDAC_L_WIN2; k++) {
        temp = sig_cur[k] * G729EV_TDAC_h[k];
        temp += ycim1[k] * *(--ptr_h);
        xr[k] = temp;
        ycim1[k] = sig_next[k];
    }

    return;
}

int main(void)
{
    REAL x[G729EV_TDAC_L_WIN * 4];
    REAL y1[G729EV_TDAC_L_WIN2];
    REAL y2[G729EV_TDAC_L_WIN2];
    REAL y3[G729EV_TDAC_L_WIN2];

    for (int i = 0; i < G729EV_TDAC_L_WIN * 4; i++) {
        x[i] = i;
    }

#if 1
    puts("x ");
    for (int i = 160; i < G729EV_TDAC_L_WIN2 * 3; i++) {
        printf("%.2f ", x[i]);
    }
    puts("");
#endif

    G729EV_TDAC_mdct(&x[0], &x[160], y1);
    G729EV_TDAC_mdct(&x[160], &x[320], y2);
    G729EV_TDAC_mdct(&x[320], &x[480], y3);

#if 0
    puts("y1");
    for (int i = 0; i < G729EV_TDAC_L_WIN2; i++) {
        printf("%.2f ", y1[i]);
    }
    puts("");
    puts("y2");
    for (int i = 0; i < G729EV_TDAC_L_WIN2; i++) {
        printf("%.2f ", y2[i]);
    }
    puts("");
    puts("y3");
    for (int i = 0; i < G729EV_TDAC_L_WIN2; i++) {
        printf("%.2f ", y3[i]);
    }
    puts("");
#endif

    REAL ycim[G729EV_TDAC_L_WIN2] = {0};
    REAL z1[G729EV_TDAC_L_WIN2];
    REAL z2[G729EV_TDAC_L_WIN2];
    REAL z3[G729EV_TDAC_L_WIN2];
    G729EV_TDAC_inv_mdct(z1, y1, ycim);
    G729EV_TDAC_inv_mdct(z2, y2, ycim);
    G729EV_TDAC_inv_mdct(z3, y3, ycim);

    puts("z2");
    for (int i = 0; i < G729EV_TDAC_L_WIN2; i++) {
        printf("%.2f ", z2[i]);
    }
    puts("");
    puts("z3");
    for (int i = 0; i < G729EV_TDAC_L_WIN2; i++) {
        printf("%.2f ", z3[i]);
    }
    puts("");

    return 0;
}
